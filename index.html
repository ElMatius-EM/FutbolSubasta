<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gran DT - Subasta en Vivo</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700;900&display=swap');
        
        body { font-family: 'Inter', sans-serif; }

        .perspective-1000 { perspective: 1000px; }
        .preserve-3d { transform-style: preserve-3d; }
        .backface-hidden { 
            -webkit-backface-visibility: hidden; 
            backface-visibility: hidden; 
        }
        .rotate-y-180 { transform: rotateY(180deg); }
        
        /* Animación para el modal */
        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(20px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        .animate-modal { animation: fade-in-up 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        
        /* Scrollbar oculta */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Fondo de fibra de carbono */
        .bg-carbon {
            background-image: url('https://www.transparenttextures.com/patterns/carbon-fibre.png');
        }
    </style>
</head>
<body class="bg-slate-950 text-white h-screen overflow-hidden flex flex-col">

    <div id="app" class="h-full w-full flex flex-col relative">
        </div>

    <script>
        // --- CONSTANTES Y DATOS ---
        const PLAYERS_DB = {
            GK: [
                { id: 'gk1', name: 'Franco Armani', team: 'River Plate', rating: 88, image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/1/18/Franco_Armani_2018.jpg/245px-Franco_Armani_2018.jpg' },
                { id: 'gk2', name: 'Sergio Romero', team: 'Boca Juniors', rating: 86, image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/c/bf/Sergio_Romero_2018.jpg/245px-Sergio_Romero_2018.jpg' },
                { id: 'gk3', name: 'Gabriel Arias', team: 'Racing Club', rating: 83, image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/4/4c/Gabriel_Arias_2018.jpg/245px-Gabriel_Arias_2018.jpg' },
                { id: 'gk4', name: 'Guido Herrera', team: 'Talleres', rating: 81, image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/e1/Guido_Herrera.jpg/245px-Guido_Herrera.jpg' }
            ],
            LD: [
                { id: 'ld1', name: 'Luis Advíncula', team: 'Boca Juniors', rating: 82, image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/c/c5/Luis_Adv%C3%ADncula_2018.jpg/245px-Luis_Adv%C3%ADncula_2018.jpg' },
                { id: 'ld2', name: 'Fabricio Bustos', team: 'River Plate', rating: 80, image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/6/6f/Fabricio_Bustos.jpg/245px-Fabricio_Bustos.jpg' },
                { id: 'ld3', name: 'Gastón Martirena', team: 'Racing Club', rating: 78, image: null },
                { id: 'ld4', name: 'Juan Barinaga', team: 'Boca Juniors', rating: 75, image: null }
            ],
            DFC1: [
                { id: 'dfc1a', name: 'Paulo Díaz', team: 'River Plate', rating: 87, image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/a/a6/Paulo_D%C3%ADaz.jpg/245px-Paulo_D%C3%ADaz.jpg' },
                { id: 'dfc1b', name: 'Cristian Lema', team: 'Boca Juniors', rating: 80, image: null },
                { id: 'dfc1c', name: 'Marco Di Cesare', team: 'Racing Club', rating: 82, image: null },
                { id: 'dfc1d', name: 'Joaquín Laso', team: 'Independiente', rating: 76, image: null }
            ],
            DFC2: [
                { id: 'dfc2a', name: 'Marcos Rojo', team: 'Boca Juniors', rating: 84, image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/1/15/Marcos_Rojo_2018.jpg/245px-Marcos_Rojo_2018.jpg' },
                { id: 'dfc2b', name: 'Germán Pezzella', team: 'River Plate', rating: 85, image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/7/76/Germ%C3%A1n_Pezzella_2018.jpg/245px-Germ%C3%A1n_Pezzella_2018.jpg' },
                { id: 'dfc2c', name: 'Carlos Izquierdoz', team: 'Lanús', rating: 79, image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/9c/Carlos_Izquierdoz.jpg/245px-Carlos_Izquierdoz.jpg' },
                { id: 'dfc2d', name: 'Walter Kannemann', team: 'Gremio (Invitado)', rating: 81, image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/0/06/Walter_Kannemann.jpg/245px-Walter_Kannemann.jpg' }
            ],
            LI: [
                { id: 'li1', name: 'Marcos Acuña', team: 'River Plate', rating: 86, image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/8/88/Marcos_Acu%C3%B1a_2018.jpg/245px-Marcos_Acu%C3%B1a_2018.jpg' },
                { id: 'li2', name: 'Lautaro Blanco', team: 'Boca Juniors', rating: 81, image: null },
                { id: 'li3', name: 'Gabriel Rojas', team: 'Racing Club', rating: 79, image: null },
                { id: 'li4', name: 'Malcom Braida', team: 'San Lorenzo', rating: 78, image: null }
            ],
            MCD: [
                { id: 'mcd1', name: 'Enzo Pérez', team: 'Estudiantes', rating: 85, image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/4/4d/Enzo_P%C3%A9rez_2018.jpg/245px-Enzo_P%C3%A9rez_2018.jpg' },
                { id: 'mcd2', name: 'Santiago Ascacíbar', team: 'Estudiantes', rating: 82, image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/95/Santiago_Ascacibar.jpg/245px-Santiago_Ascacibar.jpg' },
                { id: 'mcd3', name: 'Rodrigo Villagra', team: 'River Plate', rating: 79, image: null },
                { id: 'mcd4', name: 'Ivan Marcone', team: 'Independiente', rating: 78, image: null }
            ],
            MC: [
                { id: 'mc1', name: 'Pol Fernández', team: 'Boca Juniors', rating: 80, image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/3d/Guillermo_Mat%C3%ADas_Fern%C3%A1ndez.jpg/245px-Guillermo_Mat%C3%ADas_Fern%C3%A1ndez.jpg' },
                { id: 'mc2', name: 'Santiago Simón', team: 'River Plate', rating: 81, image: null },
                { id: 'mc3', name: 'Juan Nardoni', team: 'Racing Club', rating: 79, image: null },
                { id: 'mc4', name: 'Rodrigo Aliendro', team: 'River Plate', rating: 82, image: null }
            ],
            MD: [
                { id: 'md1', name: 'Claudio Aquino', team: 'Vélez', rating: 86, image: null },
                { id: 'md2', name: 'Maxi Meza', team: 'River Plate', rating: 83, image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/5/55/Maximiliano_Meza_2018.jpg/245px-Maximiliano_Meza_2018.jpg' },
                { id: 'md3', name: 'Exequiel Zeballos', team: 'Boca Juniors', rating: 81, image: null },
                { id: 'md4', name: 'Santiago Sosa', team: 'Racing Club', rating: 80, image: null }
            ],
            MI: [
                { id: 'mi1', name: 'Kevin Zenón', team: 'Boca Juniors', rating: 88, image: null },
                { id: 'mi2', name: 'Juanfer Quintero', team: 'Racing Club', rating: 85, image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/4/43/Juan_Fernando_Quintero_2018.jpg/245px-Juan_Fernando_Quintero_2018.jpg' },
                { id: 'mi3', name: 'Pity Martínez', team: 'River Plate', rating: 84, image: null },
                { id: 'mi4', name: 'Franco Cervi', team: 'Celta (Posible)', rating: 80, image: null }
            ],
            DC1: [
                { id: 'dc1a', name: 'Edinson Cavani', team: 'Boca Juniors', rating: 89, image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/22/Edinson_Cavani_2018.jpg/245px-Edinson_Cavani_2018.jpg' },
                { id: 'dc1b', name: 'Maravilla Martínez', team: 'Racing Club', rating: 86, image: null },
                { id: 'dc1c', name: 'Walter Bou', team: 'Lanús', rating: 82, image: null },
                { id: 'dc1d', name: 'Gabriel Ávalos', team: 'Independiente', rating: 80, image: null }
            ],
            DC2: [
                { id: 'dc2a', name: 'Miguel Borja', team: 'River Plate', rating: 88, image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/4/43/Miguel_Borja_2018.jpg/245px-Miguel_Borja_2018.jpg' },
                { id: 'dc2b', name: 'Miguel Merentiel', team: 'Boca Juniors', rating: 85, image: null },
                { id: 'dc2c', name: 'Pablo Solari', team: 'River Plate', rating: 81, image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/1/1a/Pablo_Solari.jpg/245px-Pablo_Solari.jpg' },
                { id: 'dc2d', name: 'Facundo Colidio', team: 'River Plate', rating: 82, image: null }
            ]
        };

        const ROUNDS_SCHEDULE = [
            { key: 'GK', label: 'Arquero', short: 'ARQ' },
            { key: 'LD', label: 'Lateral Derecho', short: 'LD' },
            { key: 'DFC1', label: 'Primer Central', short: 'DFC' },
            { key: 'DFC2', label: 'Segundo Central', short: 'DFC' },
            { key: 'LI', label: 'Lateral Izquierdo', short: 'LI' },
            { key: 'MCD', label: 'Volante Central (5)', short: 'MCD' },
            { key: 'MC', label: 'Volante Mixto', short: 'MC' },
            { key: 'MD', label: 'Volante Ofensivo Der.', short: 'MD' },
            { key: 'MI', label: 'Volante Creativo Izq.', short: 'MI' },
            { key: 'DC1', label: 'Delantero de Área', short: 'DC' },
            { key: 'DC2', label: 'Segundo Delantero', short: 'DC' }
        ];

        const PENALTY_PLAYER = { name: 'Jugador Libre', team: 'Sin Club', rating: 55, image: null };
        const INITIAL_BUDGET = 900;
        const MIN_BID_INCREMENT = 10;
        const INITIAL_SQUAD = {
            GK: null, LD: null, DFC1: null, DFC2: null, LI: null,
            MCD: null, MC: null, MD: null, MI: null,
            DC1: null, DC2: null
        };

        // --- ESTADO DE LA APLICACIÓN ---
        let state = {
            phase: 'SETUP', // SETUP, AUCTION_BID, AUCTION_PICK, GAME_OVER
            roundIndex: 0,
            participants: [
                { id: 0, name: '', budget: INITIAL_BUDGET, squad: { ...INITIAL_SQUAD }, totalRating: 0 },
                { id: 1, name: '', budget: INITIAL_BUDGET, squad: { ...INITIAL_SQUAD }, totalRating: 0 },
                { id: 2, name: '', budget: INITIAL_BUDGET, squad: { ...INITIAL_SQUAD }, totalRating: 0 },
                { id: 3, name: '', budget: INITIAL_BUDGET, squad: { ...INITIAL_SQUAD }, totalRating: 0 },
            ],
            currentBids: { 0: 0, 1: 0, 2: 0, 3: 0 },
            pickOrder: [],
            currentPickerIndex: 0,
            availableCards: [],
            activeAuction: null
        };

        // --- LÓGICA DEL JUEGO ---

        window.Game = {
            handleNameChange: (id, val) => {
                state.participants[id].name = val;
                render();
            },
            
            handleBidChange: (id, val) => {
                state.currentBids[id] = parseInt(val) || 0;
                // No llamamos a render completo para no perder el foco del input,
                // pero actualizamos el estado.
            },

            startGame: () => {
                state.participants = state.participants.map(p => ({ ...p, name: p.name || `DT ${p.id + 1}` }));
                Game.startRound(0);
            },

            startRound: (rIdx) => {
                state.roundIndex = rIdx;
                state.phase = 'AUCTION_BID';
                state.currentBids = { 0: 0, 1: 0, 2: 0, 3: 0 };
                const roundKey = ROUNDS_SCHEDULE[rIdx].key;
                
                // Mezclar jugadores
                const shuffled = [...PLAYERS_DB[roundKey]].sort(() => Math.random() - 0.5);
                state.availableCards = shuffled.map(p => ({ ...p, revealed: false, ownerId: null }));
                
                render();
            },

            submitBids: () => {
                const bidsArray = state.participants.map(p => ({
                    id: p.id,
                    bid: parseInt(state.currentBids[p.id]) || 0
                })).sort((a, b) => b.bid - a.bid || Math.random() - 0.5);

                state.pickOrder = bidsArray;
                state.currentPickerIndex = 0;
                state.phase = 'AUCTION_PICK';
                render();
            },

            handlePickCard: (cardIndex) => {
                if (state.availableCards[cardIndex].revealed) return;
                
                const currentPickerInfo = state.pickOrder[state.currentPickerIndex];
                state.activeAuction = {
                    cardIndex: cardIndex,
                    currentWinnerId: currentPickerInfo.id,
                    currentPrice: currentPickerInfo.bid,
                    originalPickerId: currentPickerInfo.id,
                    cardData: state.availableCards[cardIndex]
                };
                render();
            },

            handleLiveBid: (bidderId) => {
                if (!state.activeAuction) return;
                state.activeAuction.currentWinnerId = bidderId;
                state.activeAuction.currentPrice += MIN_BID_INCREMENT;
                render();
            },

            finalizeAuction: () => {
                if (!state.activeAuction) return;
                
                const { cardIndex, currentWinnerId, currentPrice } = state.activeAuction;
                
                // Descontar presupuesto
                state.participants[currentWinnerId].budget -= currentPrice;
                
                let finalPlayer = state.availableCards[cardIndex];
                
                // Lógica de bancarrota
                if (state.participants[currentWinnerId].budget < 0) {
                    finalPlayer = { ...finalPlayer, ...PENALTY_PLAYER, name: `${finalPlayer.name} (Embargado)` };
                }

                // Asignar jugador
                const currentRoundInfo = ROUNDS_SCHEDULE[state.roundIndex];
                state.participants[currentWinnerId].squad[currentRoundInfo.key] = finalPlayer;

                // Marcar carta como revelada
                state.availableCards[cardIndex].revealed = true;
                state.availableCards[cardIndex].ownerId = currentWinnerId;
                state.availableCards[cardIndex].finalStat = finalPlayer;

                state.activeAuction = null;
                
                Game.advanceTurn();
            },

            advanceTurn: () => {
                const roundKey = ROUNDS_SCHEDULE[state.roundIndex].key;
                // Buscar siguiente participante que no tenga carta en esta ronda
                const nextPickerIndex = state.pickOrder.findIndex(p => state.participants[p.id].squad[roundKey] === null);
                
                if (nextPickerIndex !== -1) {
                    state.currentPickerIndex = nextPickerIndex;
                    render();
                } else {
                    // Fin de la ronda, mostrar brevemente y avanzar
                    render(); // Renderizar el estado final de la mesa
                    setTimeout(() => {
                        if (state.roundIndex < ROUNDS_SCHEDULE.length - 1) {
                            Game.startRound(state.roundIndex + 1);
                        } else {
                            Game.calculateFinalScores();
                        }
                    }, 1500);
                }
            },

            calculateFinalScores: () => {
                state.participants = state.participants.map(p => {
                    const stats = Object.values(p.squad).map(s => s ? s.rating : 0);
                    const avg = Math.round(stats.reduce((a, b) => a + b, 0) / stats.length);
                    return { ...p, totalRating: avg };
                });
                state.phase = 'GAME_OVER';
                render();
            },
            
            reload: () => window.location.reload()
        };

        // --- COMPONENTES UI (TEMPLATE STRINGS) ---

        function PlayerToken(player, label, small = false) {
            if (!player) {
                return `
                <div class="flex flex-col items-center justify-center opacity-30 ${small ? 'scale-75' : ''}"> 
                    <div class="w-6 h-6 md:w-10 md:h-10 rounded-full border border-dashed border-white bg-transparent"></div> 
                    <span class="text-[7px] md:text-[9px] mt-0.5 font-bold">${label}</span> 
                </div>`;
            }
            
            const ringClass = player.rating >= 85 ? 'border-yellow-400 ring-1 md:ring-2 ring-yellow-400/50' : 'border-white';
            const imgContent = player.image && player.image !== 'placeholder' 
                ? `<img src="${player.image}" alt="" class="w-full h-full object-cover" />` 
                : `<span class="font-black text-white text-xs md:text-base">${player.rating}</span>`;

            return `
            <div class="flex flex-col items-center group relative ${small ? 'scale-75' : ''}">
                 <div class="${ringClass} w-8 h-8 md:w-12 md:h-12 rounded-full border-2 bg-slate-800 flex items-center justify-center overflow-hidden shadow-lg relative z-10">
                    ${imgContent}
                 </div>
                 <div class="bg-slate-900 text-white text-[7px] md:text-[9px] px-1.5 py-0.5 rounded-full mt-[-4px] md:mt-[-6px] z-20 font-bold uppercase whitespace-nowrap border border-slate-700 shadow-md max-w-[50px] md:max-w-none truncate"> 
                    ${player.name.split(' ').pop()} 
                 </div>
            </div>`;
        }

        // --- RENDER PRINCIPAL ---

        function render() {
            const app = document.getElementById('app');
            let html = '';

            // --- FASE 1: SETUP ---
            if (state.phase === 'SETUP') {
                html += `
                <div class="absolute inset-0 z-50 bg-gradient-to-br from-blue-950 to-slate-950 flex flex-col items-center justify-center p-4">
                  <div class="bg-white/10 backdrop-blur-xl p-6 md:p-8 rounded-3xl shadow-2xl max-w-lg w-full border border-white/10 flex flex-col max-h-[90vh] overflow-y-auto">
                    <div class="text-center mb-6">
                      <h1 class="text-3xl md:text-4xl font-black mb-2 tracking-tighter uppercase text-yellow-400">Gran DT</h1>
                      <p class="text-blue-200 text-sm md:text-lg font-light">Liga Argentina • 44 Estrellas</p>
                    </div>
                    <div class="grid grid-cols-1 gap-4 mb-6">
                      ${state.participants.map((p, i) => `
                        <div class="flex flex-col gap-1">
                          <label class="text-[10px] font-bold text-blue-300 uppercase pl-1">DT ${i + 1}</label>
                          <input
                            type="text"
                            placeholder="Nombre del DT ${i + 1}"
                            value="${p.name}"
                            oninput="window.Game.handleNameChange(${i}, this.value)"
                            class="w-full px-4 py-3 bg-slate-800/80 text-white rounded-xl font-bold border border-slate-700 focus:border-yellow-400 outline-none transition-all focus:bg-slate-800"
                          />
                        </div>
                      `).join('')}
                    </div>
                    <button onclick="window.Game.startGame()" class="w-full bg-gradient-to-r from-yellow-500 to-yellow-600 text-slate-900 font-black py-4 rounded-xl text-lg shadow-lg active:scale-95 transition-all">
                      INICIAR TEMPORADA
                    </button>
                  </div>
                </div>`;
            }

            // --- FASE 4: GAME OVER ---
            else if (state.phase === 'GAME_OVER') {
                const sortedParticipants = [...state.participants].sort((a, b) => b.totalRating - a.totalRating);
                html += `
                <div class="absolute inset-0 z-50 bg-slate-950 flex flex-col items-center p-4 overflow-y-auto">
                  <h1 class="text-3xl md:text-4xl font-black text-yellow-400 mb-8 mt-4 uppercase">Resultados</h1>
                  <div class="grid grid-cols-1 gap-6 w-full max-w-5xl pb-10">
                    ${sortedParticipants.map((p, idx) => `
                      <div class="bg-slate-900 rounded-2xl overflow-hidden shadow-2xl flex flex-col border border-slate-800">
                        <div class="p-4 flex justify-between items-center ${idx === 0 ? 'bg-gradient-to-r from-yellow-500 to-orange-500 text-slate-900' : 'bg-slate-800 text-white'}">
                          <div class="flex items-center gap-3">
                              <div class="w-8 h-8 bg-black/20 rounded-full flex items-center justify-center font-black text-lg">${idx + 1}</div>
                              <div>
                                  <h2 class="text-xl font-black uppercase leading-none">${p.name}</h2>
                                  <div class="text-[10px] font-bold opacity-75 uppercase flex gap-3 mt-1">
                                      <span>Rating: ${p.totalRating}</span><span>$${p.budget}M</span>
                                  </div>
                              </div>
                          </div>
                        </div>
                        <div class="p-4 bg-green-900/50 relative">
                           <div class="grid grid-cols-11 gap-1 h-12 md:h-16">
                                <div class="col-span-1 flex items-center justify-center">${PlayerToken(p.squad.GK, "ARQ", true)}</div>
                                <div class="col-span-4 flex items-center justify-around border-l border-white/10 border-r">
                                    ${PlayerToken(p.squad.LI, "LI", true)}${PlayerToken(p.squad.DFC2, "DFC", true)}
                                    ${PlayerToken(p.squad.DFC1, "DFC", true)}${PlayerToken(p.squad.LD, "LD", true)}
                                </div>
                                <div class="col-span-4 flex items-center justify-around border-r border-white/10">
                                     ${PlayerToken(p.squad.MI, "MI", true)}${PlayerToken(p.squad.MCD, "MCD", true)}
                                     ${PlayerToken(p.squad.MC, "MC", true)}${PlayerToken(p.squad.MD, "MD", true)}
                                </div>
                                <div class="col-span-2 flex items-center justify-around">
                                    ${PlayerToken(p.squad.DC1, "DC", true)}${PlayerToken(p.squad.DC2, "DC", true)}
                                </div>
                           </div>
                        </div>
                      </div>
                    `).join('')}
                  </div>
                  <button onclick="window.Game.reload()" class="mb-8 bg-white text-slate-900 px-8 py-3 rounded-full font-bold shadow-lg">Jugar Nueva Temporada</button>
                </div>`;
            }

            // --- FASE JUEGO PRINCIPAL ---
            else {
                const currentRoundInfo = ROUNDS_SCHEDULE[state.roundIndex];
                const activePickerId = state.pickOrder[state.currentPickerIndex]?.id;

                // 1. MODAL DE SUBASTA
                if (state.activeAuction) {
                    const { cardData, currentPrice, currentWinnerId } = state.activeAuction;
                    html += `
                    <div class="absolute inset-0 z-50 bg-slate-950/90 backdrop-blur-md flex items-end md:items-center justify-center p-0 md:p-4">
                      <div class="bg-white text-slate-900 rounded-t-3xl md:rounded-3xl w-full max-w-4xl max-h-[90vh] flex flex-col md:flex-row animate-modal shadow-2xl overflow-hidden">
                         
                         <div class="w-full md:w-5/12 bg-blue-700 p-6 flex flex-col items-center justify-center text-white relative shrink-0">
                            <div class="w-24 h-24 md:w-40 md:h-40 bg-white rounded-full flex items-center justify-center mb-2 md:mb-6 border-4 border-blue-400/50 shadow-xl overflow-hidden shrink-0">
                                ${cardData.image && cardData.image !== 'placeholder' 
                                    ? `<img src="${cardData.image}" alt="" class="w-full h-full object-cover">`
                                    : `<i data-lucide="users" class="w-10 h-10 text-slate-300"></i>`
                                }
                            </div>
                            <h2 class="text-xl md:text-3xl font-black text-center leading-tight mb-1">${cardData.name}</h2>
                            <div class="flex items-center gap-2 mb-2"><i data-lucide="shirt" class="w-3 h-3 md:w-4 md:h-4 text-blue-300"></i> <span class="text-blue-100 text-xs md:text-base font-medium">${cardData.team}</span></div>
                            <div class="bg-white text-blue-900 px-4 py-1 md:px-6 md:py-2 rounded-lg font-black text-2xl md:text-4xl shadow-lg">${cardData.rating}</div>
                         </div>

                         <div class="w-full md:w-7/12 p-4 md:p-8 flex flex-col bg-slate-50 flex-1 overflow-hidden">
                            <div class="flex justify-between items-end mb-4 border-b border-slate-200 pb-2 shrink-0">
                                <div>
                                    <h3 class="text-slate-400 font-bold text-[10px] uppercase">Precio</h3>
                                    <div class="text-3xl md:text-5xl font-black text-green-600">$${currentPrice}M</div>
                                </div>
                                <div class="text-right">
                                    <h3 class="text-slate-400 font-bold text-[10px] uppercase">Líder</h3>
                                    <div class="text-sm md:text-lg font-bold text-slate-800 bg-yellow-300 px-3 py-1 rounded-full truncate max-w-[120px]">
                                        ${state.participants[currentWinnerId].name}
                                    </div>
                                </div>
                            </div>

                            <div class="flex-1 overflow-y-auto no-scrollbar mb-4 grid grid-cols-2 gap-2 md:gap-4 content-start">
                                ${state.participants.map(p => {
                                    const isWinner = p.id === currentWinnerId;
                                    const alreadyHasCard = p.squad[currentRoundInfo.key] !== null;
                                    if (alreadyHasCard) return '';
                                    
                                    const btnClass = isWinner 
                                        ? 'bg-green-50 border-green-500 cursor-default' 
                                        : 'bg-white border-slate-200 active:bg-yellow-100 active:border-yellow-400';
                                    const textClass = isWinner ? 'text-green-600' : 'text-slate-500';

                                    return `
                                    <button onclick="window.Game.handleLiveBid(${p.id})" ${isWinner ? 'disabled' : ''} 
                                        class="p-3 rounded-xl border-2 flex flex-col items-center justify-center transition-all min-h-[80px] ${btnClass}">
                                        <span class="font-bold text-slate-800 text-sm md:text-lg mb-1 truncate w-full text-center">${p.name}</span>
                                        <div class="flex items-center gap-1 text-[10px] md:text-xs font-bold ${textClass}">
                                            ${isWinner ? 'GANANDO' : `+ $${MIN_BID_INCREMENT}M`}
                                        </div>
                                    </button>`;
                                }).join('')}
                            </div>
                            <button onclick="window.Game.finalizeAuction()" class="w-full bg-slate-900 text-white font-bold py-4 rounded-xl shadow-xl flex items-center justify-center gap-2 text-base md:text-lg active:bg-slate-800 shrink-0">
                                <i data-lucide="hand-coins" class="w-5 h-5 text-yellow-400"></i> CERRAR VENTA
                            </button>
                         </div>
                      </div>
                    </div>`;
                }

                // 2. HEADER
                html += `
                <header class="bg-slate-950 px-4 py-3 border-b border-white/10 flex justify-between items-center z-10 shrink-0 h-14 md:h-16">
                    <div class="flex items-center gap-3">
                        <div class="bg-yellow-500 text-slate-900 font-black px-2 py-1 md:px-3 md:py-1 rounded text-xs md:text-sm whitespace-nowrap">R ${state.roundIndex + 1}/11</div>
                        <div class="leading-tight">
                            <span class="text-[10px] md:text-xs text-slate-400 block uppercase">Mercado</span>
                            <span class="text-sm md:text-lg font-bold text-white uppercase text-yellow-400 truncate max-w-[150px] md:max-w-none block">${currentRoundInfo.label}</span>
                        </div>
                    </div>
                    <div class="flex gap-2 text-[10px] md:text-xs font-medium">
                        <div class="text-white bg-slate-800 px-2 py-1 md:px-3 rounded border border-slate-700">
                           ${state.phase === 'AUCTION_BID' ? 'OFERTA' : 'SELECCIÓN'}
                        </div>
                    </div>
                </header>`;

                // 3. LAYOUT PRINCIPAL
                html += `<div class="flex-1 flex flex-col md:flex-row overflow-hidden">`;

                // 3.1 SIDEBAR
                html += `
                <div class="w-full md:w-80 bg-slate-900 border-b md:border-b-0 md:border-r border-white/5 flex flex-col shrink-0 h-[35vh] md:h-auto z-20">
                    <div class="flex-1 overflow-y-auto no-scrollbar">
                        ${state.participants.map(p => {
                            const isCurrentPicker = state.phase === 'AUCTION_PICK' && activePickerId === p.id && !state.activeAuction;
                            const hasCardInRound = p.squad[currentRoundInfo.key] !== null;
                            const activeClass = isCurrentPicker ? 'bg-yellow-500/10' : '';
                            const doneClass = hasCardInRound ? 'opacity-50 grayscale' : '';
                            
                            return `
                            <div class="p-3 md:p-5 border-b border-white/5 transition-all relative ${activeClass} ${doneClass}">
                                ${isCurrentPicker ? '<div class="absolute left-0 top-0 bottom-0 w-1 bg-yellow-400 animate-pulse"></div>' : ''}
                                <div class="flex justify-between items-center mb-1 md:mb-2">
                                    <div class="font-bold text-white text-sm md:text-lg leading-tight truncate w-1/2">${p.name}</div>
                                    <div class="font-mono font-bold text-sm md:text-lg ${p.budget < 0 ? 'text-red-400' : 'text-green-400'}">$${p.budget}M</div>
                                </div>
                                ${state.phase === 'AUCTION_BID' && !hasCardInRound ? `
                                    <div class="flex items-center gap-2 mt-1">
                                        <div class="relative group flex-1">
                                            <i data-lucide="dollar-sign" class="absolute left-2 top-1/2 -translate-y-1/2 w-3 h-3 text-slate-500"></i>
                                            <input type="number" 
                                                class="w-full bg-slate-950 text-white pl-7 pr-2 py-1.5 rounded text-sm border border-slate-700 focus:border-yellow-400 outline-none font-mono" 
                                                value="${state.currentBids[p.id] || ''}" 
                                                onchange="window.Game.handleBidChange(${p.id}, this.value)"
                                                placeholder="0" 
                                            />
                                        </div>
                                    </div>
                                ` : ''}
                                ${isCurrentPicker ? `<div class="mt-1 text-yellow-400 text-[10px] md:text-xs font-bold animate-pulse flex items-center gap-1"><i data-lucide="chevron-right" class="w-3 h-3"></i> TU TURNO</div>` : ''}
                            </div>`;
                        }).join('')}
                    </div>
                    ${state.phase === 'AUCTION_BID' ? `
                        <div class="p-3 bg-slate-900 border-t border-white/10 shrink-0">
                             <button onclick="window.Game.submitBids()" class="w-full bg-yellow-500 text-slate-900 font-bold py-3 rounded-lg shadow-lg active:scale-95 text-xs md:text-sm uppercase tracking-wider flex justify-center items-center gap-2">
                                 <i data-lucide="gavel" class="w-4 h-4"></i> OFERTAR
                             </button>
                        </div>
                    ` : ''}
                </div>`;

                // 3.2 MESA DE JUEGO
                html += `
                <div class="flex-1 relative bg-slate-800 flex flex-col items-center justify-center p-4 overflow-hidden">
                    <div class="absolute inset-0 bg-carbon opacity-30 pointer-events-none"></div>
                    
                    ${state.phase === 'AUCTION_PICK' && !state.activeAuction && activePickerId !== undefined ? `
                        <div class="bg-yellow-500 text-slate-900 px-4 py-2 rounded-full mb-4 md:mb-8 z-10 shadow-lg animate-bounce text-xs md:text-sm font-bold border-2 border-slate-900/10 text-center max-w-[80%] truncate">
                            Turno: ${state.participants[activePickerId].name}
                        </div>
                    ` : ''}

                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-8 z-10 w-full max-w-sm md:max-w-6xl h-full md:h-auto content-center">
                        ${state.availableCards.map((card, idx) => {
                            const canPick = state.phase === 'AUCTION_PICK' && !card.revealed && !state.activeAuction && activePickerId !== undefined;
                            const onClick = canPick ? `onclick="window.Game.handlePickCard(${idx})"` : '';
                            const cursorClass = card.revealed ? 'cursor-default' : 'cursor-pointer';
                            const pulseClass = canPick ? 'animate-pulse' : '';
                            const rotateClass = card.revealed ? 'rotate-y-180' : '';

                            return `
                            <div ${onClick} class="relative group perspective-1000 aspect-[3/4] ${cursorClass} ${pulseClass}">
                                <div class="w-full h-full transition-transform duration-700 preserve-3d relative ${rotateClass}">
                                    
                                    <div class="absolute inset-0 backface-hidden bg-slate-700 rounded-xl shadow-lg border-4 border-slate-600 flex flex-col items-center justify-center z-20">
                                        <div class="w-16 h-16 md:w-24 md:h-24 bg-slate-800 rounded-full flex items-center justify-center mb-2 md:mb-4 shadow-inner">
                                            <i data-lucide="user" class="w-8 h-8 md:w-12 md:h-12 text-slate-500"></i>
                                        </div>
                                        <div class="text-yellow-500/20 font-black text-4xl md:text-6xl select-none absolute bottom-2 right-2">?</div>
                                    </div>

                                    <div class="absolute inset-0 backface-hidden rotate-y-180 bg-slate-900 rounded-xl shadow-lg border-4 border-slate-500 flex flex-col items-center justify-center z-10">
                                        <div class="w-16 h-16 md:w-24 md:h-24 bg-slate-800 rounded-full flex items-center justify-center mb-3 shadow-lg overflow-hidden">
                                            ${card.revealed && card.finalStat.image && card.finalStat.image !== 'placeholder'
                                                ? `<img src="${card.finalStat.image}" class="w-full h-full object-cover">`
                                                : `<i data-lucide="user" class="w-8 h-8 md:w-12 md:h-12 text-slate-600"></i>`
                                            }
                                        </div>
                                        <div class="bg-red-500 text-white font-black text-[10px] md:text-xs uppercase px-2 py-0.5 rounded transform -rotate-6 shadow mb-1">VENDIDO</div>
                                        <div class="text-white font-bold text-center text-xs md:text-base px-2 truncate w-full">
                                            ${card.finalStat?.name || ''}
                                        </div>
                                    </div>
                                </div>
                            </div>`;
                        }).join('')}
                    </div>
                </div>`;
                
                html += `</div>`; // End Layout
            }

            app.innerHTML = html;
            lucide.createIcons();
        }

        // Inicializar
        render();

    </script>
</body>
</html>
